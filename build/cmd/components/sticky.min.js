define(function(t,e,i){"use strict";var s=t("../util"),n=t("../base"),r=s.prefixStyle("transform"),c=function(t){var e=t.stickyElement,i=t.curStickyElement,n=t.xscroll,r=t._,c=n.getPlugin("infinite");if(c){c.userConfig.renderHook.call(self,e,i),e.setAttribute("xs-guid",i.guid),s.addClass(e,i.className);for(var o in i.style)"display"!=o&&"position"!=o&&(e.style[o]=o==r.height?i.style[o]+"px":i.style[o])}else{var l=i.getAttribute("style");e.innerHTML=i.innerHTML,e.className=i.className,l&&e.setAttribute("style",l)}},o=function(t){o.superclass.constructor.call(this,t),this.userConfig=s.mix({stickyRenderTo:void 0,forceSticky:!0,prefix:"xs-sticky-container",stickyRenderFunc:c,zoomType:"y"},t),this.init()};return s.extend(o,n,{init:function(){{var t=this,e=t.userConfig;t.xscroll=e.xscroll,t.isY=!("y"!=e.zoomType)}return t._={top:t.isY?"top":"left",left:t.isY?"left":"bottom",right:t.isY?"right":"top",height:t.isY?"height":"width",width:t.isY?"width":"height"},t.stickyRenderTo=s.getNode(e.stickyRenderTo),t},getStickiesPos:function(){for(var t=this,e=(t.xscroll,t.isInfinite),i=t.isY,n=t._,r=[],c=function(r){var c={};return e?(c[n.top]=i?r._top:r._left,c[n.height]=i?r._height:r._width):(c[n.top]=t.isY?s.getOffsetTop(r):s.getOffsetLeft(r),c[n.height]=t.isY?r.offsetHeight:r.offsetWidth),c},o=0;o<t.stickiesNum;o++){var l=c(t.stickyElements[o]);l.el=t.createStickyEl(),l.isRender=!1,r.push(l)}return r},getStickyElements:function(){var t=this,e=t.xscroll,i=(t.userConfig,t.isInfinite,e.getPlugin("infinite"));if(i){var n=[],r=i.__serializedData;for(var c in r){var o=r[c];o&&o.style&&"sticky"==o.style.position&&n.push(o)}return n}return s.getNodes(e.userConfig.stickyElements,e.content)},render:function(){var t=this,e=t.userConfig,i=t.xscroll;t.isInfinite=!!i.getPlugin("infinite");var n=t._;if(t.stickyElements=t.getStickyElements(),t.stickiesNum=t.stickyElements&&t.stickyElements.length,t.stickiesNum){t.stickyRenderTo||(t.stickyRenderTo=document.createElement("div"),i.renderTo.appendChild(t.stickyRenderTo)),t.stickiesPos=t.getStickiesPos();var r=t.stickyRenderTo;r.style[n.top]=0,r.style[n.left]=0,r.style[n.right]=0,r.style.position=i.userConfig.useOriginScroll?"fixed":"absolute",s.addClass(t.stickyRenderTo,e.prefix),t.stickyHandler(),t._bindEvt()}},createStickyEl:function(){var t=this,e=document.createElement("div");return e.style.display="none",s.addClass(e,"xs-sticky-handler"),t.stickyRenderTo.appendChild(e),e},_bindEvt:function(){var t=this,e=t.xscroll;e.on("scroll",t.stickyHandler,t)},stickyHandler:function(){for(var t=this,e=t.xscroll,i=(t.userConfig,t.isY?e.getScrollTop():e.getScrollLeft()),s=t.stickiesPos,n=t._,c=[],o=0,l=s.length;l>o;o++){var y=s[o][n.top];i>y&&c.push(o)}if(!c.length)return t.stickyElement&&(t.stickyElement.style.display="none"),void(t.curStickyIndex=void 0);var a=Math.max.apply(null,c);if(t.curStickyIndex!=a){var d=t.curStickyIndex;t.curStickyIndex=a,t.curStickyElement=t.stickyElements[a],t.curStickyPos=s[a],t.stickyElement=t.curStickyPos.el;for(var o=0,l=s.length;l>o;o++)s[o].el.style.display="none";var u={stickyElement:t.stickyElement,curStickyIndex:t.curStickyIndex,prevStickyIndex:d,curStickyPos:t.curStickyPos,isRender:t.curStickyPos.isRender};e.trigger("beforestickychange",u),t._stickyRenderFunc(t),e.trigger("stickychange",u)}var k=0;if(t.stickiesPos[t.curStickyIndex+1]){var f=t.stickiesPos[t.curStickyIndex],h=t.stickiesPos[t.curStickyIndex+1];k=i+f[n.height]>h[n.top]&&i+f[n.height]<h[n.top]+f[n.height]?f[n.height]+i-h[n.top]:0}t.stickyElement.style[r]=t.isY?"translateY(-"+k+"px) translateZ(0)":"translateX(-"+k+"px) translateZ(0)"},_stickyRenderFunc:function(t){var e=this,i=e._,s=e.userConfig.stickyRenderFunc,n=e.curStickyPos.el;e.curStickyPos.isRender||(n.style[i.left]=0,n.style[i.right]=0,s&&s.call(e,t)),n.style.display="block",e.curStickyPos.isRender=!0},destroy:function(){var t=this;t.stickyElements=void 0,t.stickiesNum=void 0,t.stickiesPos=void 0,s.remove(t.stickyElement),t.stickyElement=void 0}}),"object"==typeof i&&i.exports?void(i.exports=o):o});