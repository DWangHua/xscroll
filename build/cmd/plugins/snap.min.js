define(function(n,o,s){"use strict";var a=n("../util"),e=n("../base"),t=function(n){t.superclass.constructor.call(this,n),this.userConfig=a.mix({snapColIndex:0,snapRowIndex:0,snapDuration:500,snapEasing:"ease",snapOffsetLeft:0,snapOffsetTop:0,autoStep:!1},n)};if(a.extend(t,e,{pluginId:"snap",pluginInitializer:function(n){var o=this;o.xscroll=n.render(),o.snapColIndex=o.userConfig.snapColIndex,o.snapRowIndex=o.userConfig.snapRowIndex,prefix=o.userConfig.prefix,o.render()},pluginDestructor:function(){var n=this,o=n.xscroll;o.on("panend",o._onpanend,o),o.off("panend",n._snapAnimate,n)},snapTo:function(n,o,s,a,e){return this.snapToCol(n,s,a,e),this.snapToRow(o,s,a,e),this},snapToCol:function(n,o,s,a){var e=this,t=e.userConfig,o=o||t.snapDuration,s=s||t.snapEasing,r=t.snapWidth,i=t.snapColsNum,l=t.snapOffsetLeft;n=n>=i?i-1:0>n?0:n,e.snapColIndex=n;var p=e.snapColIndex*r+l;return e.xscroll.scrollLeft(p,o,s,a),e},snapToRow:function(n,o,s,a){var e=this,t=e.userConfig,o=o||t.snapDuration,s=s||t.snapEasing,r=t.snapHeight,i=t.snapRowsNum,l=t.snapOffsetTop;n=n>=i?i-1:0>n?0:n,e.snapRowIndex=n;var p=e.snapRowIndex*r+l;return e.xscroll.scrollTop(p,o,s,a),e},_snapAnimate:function(n){var o=this,s=o.userConfig,a=s.snapWidth,e=s.snapHeight;o.xscroll.__topstart=null,o.xscroll.__leftstart=null;var t=n.direction;if(Math.abs(n.velocity)<=.2){var r=Math.abs(o.xscroll.getScrollLeft()),i=Math.abs(o.xscroll.getScrollTop());o.snapColIndex=Math.round(r/a),o.snapRowIndex=Math.round(i/e),o.snapTo(o.snapColIndex,o.snapRowIndex)}else if(s.autoStep){var l=o.xscroll.computeScroll("x",n.velocityX),p=o.xscroll.computeScroll("y",n.velocityY),u=l&&l.pos?Math.round(l.pos/a):o.snapColIndex,d=p&&p.pos?Math.round(p.pos/e):o.snapRowIndex,c=Math.ceil(l&&l.duration,p&&p.duration);l&&"inside"==l.status?o.snapToCol(u,c,l&&l.easing,function(){o.xscroll.boundryCheckX()}):l&&o.xscroll.scrollLeft(l.pos,l.duration,l.easing,function(){o.xscroll.boundryCheckX(),o.snapColIndex=Math.round(Math.abs(o.xscroll.getScrollLeft())/a)}),p&&"inside"==p.status?o.snapToRow(d,c,p&&p.easing,function(){o.xscroll.boundryCheckY()}):p&&o.xscroll.scrollTop(p.pos,p.duration,p.easing,function(){o.xscroll.boundryCheckY(),o.snapRowIndex=Math.round(Math.abs(o.xscroll.getScrollTop())/e)})}else 2==t?o.snapColIndex++:4==t?o.snapColIndex--:void 0,8==t?o.snapRowIndex++:16==t?o.snapRowIndex--:void 0,o.snapTo(o.snapColIndex,o.snapRowIndex)},render:function(){var n=this,o=n.xscroll;return n.userConfig.snapWidth=n.userConfig.snapWidth||o.width||100,n.userConfig.snapHeight=n.userConfig.snapHeight||o.height||100,n.userConfig.snapColsNum=n.userConfig.snapColsNum||Math.max(Math.round(o.containerWidth/o.width),1),n.userConfig.snapRowsNum=n.userConfig.snapRowsNum||Math.max(Math.round(o.containerHeight/o.height),1),o.off("panend",o._onpanend),o.on("panend",n._snapAnimate,n),n}}),"object"==typeof s&&s.exports)s.exports=t;else if(window.XScroll&&window.XScroll.Plugins)return XScroll.Plugins.Snap=t});