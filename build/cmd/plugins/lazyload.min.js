define(function(e,t,o){"use strict";var i=e("../util"),r=e("../base"),l=function(e){l.superclass.constructor.call(this,e),this.userConfig=i.mix({imgsSelector:"img",delay:200,formatter:function(e){return e}},e)};if(i.extend(l,r,{pluginId:"lazyload",pluginInitializer:function(e){var t=this;return t.xscroll=e,t.reset(),t._bindEvt(),t},pluginDestructor:function(){var e=this;e.xscroll&&(e.xscroll.off("scroll scrollend afterrender",e._filterItem,e),e.xscroll.off("scroll scrollend afterrender",e._filterItemByInfinite,e)),e._isEvtBinded=!1},_setImgSrc:function(e){if(e){var t=e.getAttribute("data-src"),o=this.userConfig.formatter.call(self,t);o&&e.setAttribute("src",o)}},_filterItem:function(e){var t,o=this,e=e||o.xscroll.getScrollPos(),i="x"==o.zoomType?e.scrollLeft:e.scrollTop,r="x"==o.zoomType?"offsetWidth":"offsetHeight",l="x"==o.zoomType?"left":"top",n="x"==o.zoomType?"right":"bottom";for(var s in o.positions)t=o.positions[s],(t[l]>=i&&t[l]<=i+o.xscroll.renderTo[r]||t[n]>=i&&t[n]<=i+o.xscroll.renderTo[r])&&o._setImgSrc(o.imgs[s])},_filterItemByInfinite:function(){var e=this,t=e.xscroll.getPlugin("infinite");clearTimeout(e._timeout),e._timeout=setTimeout(function(){if(!e.xscroll["isScrolling"+e.zoomType.toUpperCase()])for(var o=0;o<t.infiniteLength;o++)if(t.infiniteElementsCache[o]._visible&&t.infiniteElements[o])for(var i=t.infiniteElements[o].querySelectorAll(e.userConfig.imgsSelector),r=0,l=i.length;l>r;r++)e._setImgSrc(i[r])},e.userConfig.delay)},reset:function(){var e,t,o=this;o.zoomType=o.xscroll.userConfig.lockX?"y":"x",o.imgs=o.xscroll.renderTo.querySelectorAll(o.userConfig.imgsSelector);var i=(o.xscroll.getScrollPos(),"x"==o.zoomType?"left":"top"),r="x"==o.zoomType?"right":"bottom",l="x"==o.zoomType?"offsetLeft":"offsetTop",n="x"==o.zoomType?"offsetWidth":"offsetHeight",s="x"==o.zoomType?"width":"height";o.positions=[];for(var f=0,c=o.imgs.length;c>f;f++)e=o.imgs[f],t={},t[i]=e[l],t[s]=e[n],t[r]=t[i]+t[s],o.positions.push(t);return o},_bindEvt:function(){var e=this;if(!e._isEvtBinded){e._isEvtBinded=!0;var t=e.xscroll.userConfig.useOriginScroll?"scroll":"scrollend";e.xscroll.on("afterrender",e.xscroll.getPlugin("infinite")?e._filterItemByInfinite:e._filterItem,e),e.xscroll.getPlugin("infinite")?e.xscroll.on(t,e._filterItemByInfinite,e):e.xscroll.on(t,e._filterItem,e)}}}),"object"==typeof o&&o.exports)o.exports=l;else if(window.XScroll&&window.XScroll.Plugins)return XScroll.Plugins.LazyLoad=l});