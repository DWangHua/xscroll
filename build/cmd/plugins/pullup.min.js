define(function(e,n,t){"use strict";var l,r=e("../util"),i=e("../base"),o="Loading...",s="Pull Up To Refresh",u="Release To Refresh",a=60,c=40,d=function(e){d.superclass.constructor.call(this),this.userConfig=r.mix({upContent:s,downContent:u,pullUpHeight:a,height:c,loadingContent:o,bufferHeight:0,clsPrefix:"xs-plugin-pullup-"},e)};if(r.extend(d,i,{pluginId:"pullup",pluginInitializer:function(e){var n=this;return n.xscroll=e.render(),l=n.userConfig.clsPrefix,n.render(),n},pluginDestructor:function(){var e=this;console.log("remove"),e.xscroll.renderTo.removeChild(e.pullup),e.xscroll.off("scrollend",e._scrollEndHandler,e),e.xscroll.off("scroll",e._scrollHandler,e),e.xscroll.off("pan",e._panHandler,e),e.xscroll.boundry.resetBottom(),e.__isRender=!1,e._evtBinded=!1},render:function(){var e=this;if(!e.__isRender){e.__isRender=!0;var n=l+"container",t=e.userConfig.height,i=e.pullup=document.createElement("div");return i.className=n,i.style.position="absolute",i.style.width="100%",i.style.height=t+"px",i.style.bottom=-t+"px",e.xscroll.container.appendChild(i),e.xscroll.boundry.expandBottom(e.userConfig.height),e.status="up",r.addClass(i,l+e.status),i.innerHTML=e.userConfig[e.status+"Content"]||e.userConfig.content,e._bindEvt(),e}},_bindEvt:function(){var e=this;if(!e._evtBinded){e._evtBinded=!0;var n=(e.pullup,e.xscroll);return n.on("pan",e._panHandler,e),e.userConfig.bufferHeight>0&&n.on("scroll",e._scrollHandler,e),n.on("scrollend",e._scrollEndHandler,e),e}},_scrollEndHandler:function(e){var n=this,t=n.xscroll,l=t.getScrollTop();return l==t.containerHeight-t.height+n.userConfig.height&&n._changeStatus("loading"),n},_scrollHandler:function(e){var n=this,t=n.xscroll;return!n.isLoading&&Math.abs(e.scrollTop)+t.height+n.userConfig.height+n.userConfig.bufferHeight>=t.containerHeight+t.boundry._xtop+t.boundry._xbottom&&n._changeStatus("loading"),n},_panHandler:function(e){var n=this,t=n.xscroll,l=-t.getScrollTop();return n._changeStatus(l<t.height-t.containerHeight-n.userConfig.pullUpHeight?"down":"up"),n},_changeStatus:function(e){if("loading"==e||!this.isLoading){var n=this.status;return this.status=e,r.removeClass(this.pullup,l+n),r.addClass(this.pullup,l+e),this.pullup.innerHTML=this.userConfig[e+"Content"],n!=e&&(this.trigger("statuschange",{prevVal:n,newVal:e}),"loading"==e&&(this.isLoading=!0,this.trigger("loading"))),this}},complete:function(){{var e=this;e.xscroll}return e.isLoading=!1,e._changeStatus("up"),e}}),"object"==typeof t&&t.exports)t.exports=d;else if(window.XScroll&&window.XScroll.Plugins)return XScroll.Plugins.PullUp=d});